#!/bin/sh

get_links() {
        curl -so/tmp/osrs.list https://downloads.khinsider.com/game-soundtracks/album/old-school-runescape

        pages="$(grep -Po '<td class="clickable-row"><a href="\K[^"]+' /tmp/osrs.list)"

        echo >osrs.links

        for page in $pages; do
                curl -s "https://downloads.khinsider.com$page" | grep -Po '<audio id="audio" controls preload="auto" src="\K[^"]+' >>osrs.links
                sleep 2
        done
}

set -eu
cd /mnt/e/osrs-music

while read -r link; do
        curl -sLO "$link"
        sleep 3
done <~/osrs.links
