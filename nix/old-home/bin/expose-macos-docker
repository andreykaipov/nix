#!/bin/sh
#
# Exposes the Docker host MacOS so that our WSL distro can use it by exporting
# DOCKER_HOST=tcp://$macos:$port.
#
# See https://github.com/docker/for-mac/issues/770.
#
# I use sshuttle on my WSL distro to proxy connections through my Macbook.
# However, Docker on Windows runs on the Windows host and not actually in WSL,
# so its outbound connections aren't sshuttled. However, to connect to private
# Docker registries, I can use my Macbook as a Docker host -- I just have to
# expose it.

docker run \
    --name expose-docker \
    --restart always \
    --detach \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -p 0.0.0.0:2375:2375 \
    bobrik/socat TCP-LISTEN:2375,fork UNIX-CONNECT:/var/run/docker.sock
